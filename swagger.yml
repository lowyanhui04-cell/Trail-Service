openapi: 3.0.0
info:
  title: "TrailService API"
  description: "API for managing trails"
  version: "1.0.0"

servers:
  - url: "/api"

components:
  # 1. SECURITY CONFIGURATION
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      x-bearerInfoFunc: auth.decode_token

  # 2. DATA MODELS (Schemas)
  schemas:
    # --- TRAIL ---
    Trail:
      type: "object"
      required:
        - Trail_Name
        - Location
        - Category_ID
        - Difficulty_ID
        - Route_ID
        - User_ID
      properties:
        Trail_ID:
          type: "integer"
          readOnly: true
        Trail_Name:
          type: "string"
        Trail_Description:
          type: "string"
        Location:
          type: "string"
        Distance:
          type: "number"
        Elevation_Gain:
          type: "integer"
        Estimate_Time:
          type: "integer"
        Trail_Info:
          type: "string"
        Category_ID:
          type: "integer"
        Difficulty_ID:
          type: "integer"
        Route_ID:
          type: "integer"
        User_ID:
          type: "integer"

    # --- LOOKUPS ---
    Category:
      type: "object"
      required:
        - Category_Name
      properties:
        Category_ID:
          type: "integer"
          readOnly: true
        Category_Name:
          type: "string"

    Difficulty:
      type: "object"
      required:
        - Difficulty_Name
      properties:
        Difficulty_ID:
          type: "integer"
          readOnly: true
        Difficulty_Name:
          type: "string"

    RouteType:
      type: "object"
      required:
        - Route_Type
      properties:
        Route_ID:
          type: "integer"
          readOnly: true
        Route_Type:
          type: "string"

    # --- FEATURES ---
    Feature:
      type: "object"
      required:
        - Feature_Name
      properties:
        Feature_ID:
          type: "integer"
          readOnly: true
        Feature_Name:
          type: "string"
        Feature_Description:
          type: "string"

    # --- POINTS ---
    TrailPoint:
      type: "object"
      required:
        - Longitude
        - Latitude
      properties:
        Point_ID:
          type: "integer"
          readOnly: true
        Trail_ID:
          type: "integer"
          readOnly: true
        Point_of_Interest:
          type: "string"
        Location_Point:
          type: "string"
        Longitude:
          type: "number"
          format: "float"
        Latitude:
          type: "number"
          format: "float"

paths:
  # ==========================================
  # 1. AUTHENTICATION
  # ==========================================
  /login:
    post:
      operationId: "auth.login"
      tags: ["Authentication"]
      summary: "Login using University Credentials"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: {type: string}
                password: {type: string}
      responses:
        "200":
          description: "Login successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: {type: string}
                  user: {type: object}
        "401":
          description: "Unauthorized"

  # ==========================================
  # 2. TRAILS (The Core)
  # ==========================================
  /trails:
    get:
      operationId: "trails.read_all"
      tags: ["Trails"]
      summary: "Read the list of trails"
      responses:
        "200":
          description: "Successfully read trail list"
    post:
      operationId: "trails.create"
      tags: ["Trails"]
      summary: "Create a new trail"
      security:
        - bearerAuth: []
      requestBody:
        description: "Trail to create"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Trail"
      responses:
        "201":
          description: "Successfully created trail"

  /trails/{trail_id}:
    get:
      operationId: "trails.read_one"
      tags: ["Trails"]
      summary: "Read one trail"
      parameters:
        - name: "trail_id"
          in: path
          required: true
          schema: {type: "integer"}
      responses:
        "200":
          description: "Successfully read trail"
        "404":
          description: "Trail not found"
    put:
      operationId: "trails.update"
      tags: ["Trails"]
      summary: "Update a trail"
      security:
        - bearerAuth: []
      parameters:
        - name: "trail_id"
          in: path
          required: true
          schema: {type: "integer"}
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Trail"
      responses:
        "200":
          description: "Successfully updated trail"
    delete:
      operationId: "trails.delete"
      tags: ["Trails"]
      summary: "Delete a trail"
      security:
        - bearerAuth: []
      parameters:
        - name: "trail_id"
          in: path
          required: true
          schema: {type: "integer"}
      responses:
        "204":
          description: "Successfully deleted trail"

  # ==========================================
  # 3. TRAIL POINTS
  # ==========================================
  /trails/{trail_id}/points:
    get:
      operationId: "trails.get_points"
      tags: ["Trail Points"]
      summary: "Get the path points for a trail"
      parameters:
        - name: "trail_id"
          in: path
          required: true
          schema: {type: "integer"}
      responses:
        "200": {description: "Success"}
        "404": {description: "Trail not found"}
    post:
      operationId: "trails.add_point"
      tags: ["Trail Points"]
      summary: "Add a GPS point to a trail"
      security:
        - bearerAuth: []
      parameters:
        - name: "trail_id"
          in: path
          required: true
          schema: {type: "integer"}
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TrailPoint"
      responses:
        "201": {description: "Point added"}

  /points/{point_id}:
    get:
      operationId: "trails.read_one_point"
      tags: ["Trail Points"]
      summary: "Get a specific GPS point"
      parameters:
        - name: "point_id"
          in: path
          required: true
          schema: {type: "integer"}
      responses:
        "200": {description: "Success"}
        "404": {description: "Not Found"}
    put:
      operationId: "trails.update_point"
      tags: ["Trail Points"]
      summary: "Update a GPS point"
      security:
        - bearerAuth: []
      parameters:
        - name: "point_id"
          in: path
          required: true
          schema: {type: "integer"}
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TrailPoint"
      responses:
        "200": {description: "Updated"}
    delete:
      operationId: "trails.delete_point"
      tags: ["Trail Points"]
      summary: "Delete a GPS point"
      security:
        - bearerAuth: []
      parameters:
        - name: "point_id"
          in: path
          required: true
          schema: {type: "integer"}
      responses:
        "204": {description: "Deleted"}

  # ==========================================
  # 4. FEATURES
  # ==========================================
  /features:
    get:
      operationId: "features.read_all"
      tags: ["Features"]
      summary: "Get list of all features"
      responses:
        "200": {description: "Success"}
    post:
      operationId: "features.create_feature"
      tags: ["Features"]
      summary: "Create a new feature definition"
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Feature"
      responses:
        "201": {description: "Created"}

  /features/{id}:
    get:
      operationId: "features.read_one_feature"
      tags: ["Features"]
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      responses: {"200": {description: "Success"}}
    put:
      operationId: "features.update_feature"
      tags: ["Features"]
      security:
        - bearerAuth: []
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Feature"
      responses: {"200": {description: "Updated"}}
    delete:
      operationId: "features.delete_feature"
      tags: ["Features"]
      security:
        - bearerAuth: []
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      responses: {"204": {description: "Deleted"}}

  /trails/{trail_id}/features/{feature_id}:
    post:
      operationId: "features.add_feature_to_trail"
      tags: ["Features"]
      summary: "Link a feature to a trail"
      security:
        - bearerAuth: []
      parameters:
        - name: trail_id
          in: path
          required: true
          schema: {type: integer}
        - name: feature_id
          in: path
          required: true
          schema: {type: integer}
      responses:
        "201":
          description: "Linked successfully"
        "400":
          description: "Error or already exists"

  # ==========================================
  # 5. LOOKUPS
  # ==========================================
  # CATEGORIES
  /categories:
    get:
      operationId: "lookups.get_categories"
      tags: ["Lookups"]
      summary: "List all trail categories"
      responses:
        "200": {description: "Success"}
    post:
      operationId: "lookups.create_category"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Category"
      responses: {"201": {description: "Created"}}

  /categories/{id}:
    get:
      operationId: "lookups.read_one_category"
      tags: ["Lookups"]
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      responses: {"200": {description: "Success"}}
    put:
      operationId: "lookups.update_category"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Category"
      responses: {"200": {description: "Updated"}}
    delete:
      operationId: "lookups.delete_category"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      responses: {"204": {description: "Deleted"}}

  # DIFFICULTIES
  /difficulties:
    get:
      operationId: "lookups.get_difficulties"
      tags: ["Lookups"]
      summary: "List all difficulty levels"
      responses:
        "200": {description: "Success"}
    post:
      operationId: "lookups.create_difficulty"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Difficulty"
      responses: {"201": {description: "Created"}}

  /difficulties/{id}:
    get:
      operationId: "lookups.read_one_difficulty"
      tags: ["Lookups"]
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      responses: {"200": {description: "Success"}}
    put:
      operationId: "lookups.update_difficulty"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Difficulty"
      responses: {"200": {description: "Updated"}}
    delete:
      operationId: "lookups.delete_difficulty"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      responses: {"204": {description: "Deleted"}}

  # ROUTE TYPES
  /route-types:
    get:
      operationId: "lookups.get_route_types"
      tags: ["Lookups"]
      summary: "List all route shapes"
      responses:
        "200": {description: "Success"}
    post:
      operationId: "lookups.create_route_type"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RouteType"
      responses: {"201": {description: "Created"}}

  /route-types/{id}:
    get:
      operationId: "lookups.read_one_route_type"
      tags: ["Lookups"]
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      responses: {"200": {description: "Success"}}
    put:
      operationId: "lookups.update_route_type"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RouteType"
      responses: {"200": {description: "Updated"}}
    delete:
      operationId: "lookups.delete_route_type"
      tags: ["Lookups"]
      security:
        - bearerAuth: []
      parameters: [{name: id, in: path, required: true, schema: {type: integer}}]
      responses: {"204": {description: "Deleted"}}